<html>
  <head>
    <script src='../../ExternalLibs/jquery.js'></script>
    <script src='../../ExternalLibs/two.js'></script>
    <script src='../../ExternalLibs/snap.svg.js'></script>
    <script src='./Core/Core.js'></script>
    <script src='./Controllers/Controller.js'></script>
    <script src='./Controllers/KeyboardC.js'></script>
    <!--<script src='./Interface/Interface.js'></script>
    <script src='./Network/Network.js'></script>-->
    <script src='./Render/Render.js'></script>
    <script src='./Render/GraphicalInstance.js'></script>    
    <!--<script src='./Render/TextRender.js'></script>
    <script src='./Render/ViewInstance.js'></script>-->
    <script src='./GameModel/Map.js'></script>
    <script src='./GameModel/GameModel.js'></script>
    <script src='./GameModel/GameObjects/GameObject.js'></script>
    <script src='../common.js'></script>
  <body>
    <div id='outputDOM' style='border: solid black 1px;width: 90%; height: 800px; margin: auto'></div>        
    <div id='SvgModels' style='display: none; padding: 10%; background-color: lightgray'></div>  
    <script>
      
      //Models loader
      var dir = "./Render/Models";      
      var fileextension = ".svg";      
      $.ajax({
          //This will retrieve the contents of the folder if the folder is configured as 'browsable'
          url: dir,
          success: function (data) {
              //List all .png file names in the page     
              var files = $(data).find("a:contains(" + fileextension + ")");
              var count = 0;
              files.each(function (e) {
                  var filename = this.href.replace("http://", "");                                    
                  $('#SvgModels').load(this.href, function(){
                    count++;                    
                    if (files.length == count) init();
                  });                  
                  //$("body").append("<img src='" + filename + "'>");                  
              });              
              //init();
          }
      });
    </script>
    <script>     
      var SVG_MODELS = {};
      var core,gameModel,render;
      function init(){
        console.warn('init')
        var outputDOM = document.getElementById('outputDOM');
        var SvgModelsDOM = document.getElementById('SvgModels');        
        var svgs = SvgModelsDOM.getElementsByTagNameNS('http://www.w3.org/2000/svg','svg');        
        SVG_MODELS = {};              
        for (var s = 0; s < svgs.length; svgs++){        
          var type = svgs[s].getElementsByTagName('title')[0].innerHTML || 'Other';
          if (!(type in SVG_MODELS)) SVG_MODELS[type] = [];
          for (var c in svgs[s].childNodes){            
            if (svgs[s].childNodes[c].nodeName == 'g')  
              SVG_MODELS[type].push(svgs[s].childNodes[c]);                           
          }
        }                                      

        core = new Core();      
        gameModel = core.initGameModel({map:new Map(35,35)});//(83,83)});      
        render = core.createRender(outputDOM, Render);      
        
        var simpleObjects = [];
        for (var x = 6; x < gameModel.map.width-25; x += 10)
          for (var y = 3; y < gameModel.map.height-4; y += 4){
            var simpleObject = new GameObject(new Pos(x,y),3,3,[1,0,0,0],1,{speed: 10})
            simpleObjects.push(simpleObject)
            gameModel.addObject(simpleObject)                

            var path = [
              1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
              3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
              1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
              3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
              1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
              3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
              1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
              3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
              1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
              3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
              1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
              3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
              1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
              3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
              1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
              3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
              1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
              3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
              1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
              3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
              1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
              3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
              1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
              3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
              1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
              3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
              1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
              3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
              1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
              3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,
              1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
              3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3 
              ];
            simpleObject.actions.setPath(path);
            simpleObject.actions.followPath(path);
          }
        var controller = new KeyboardC().setTargetObject(simpleObjects[0]);        
      }
    </script>
  </body>
</html>