(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(){this.removeEyecatcher=t(this.removeEyecatcher,this),this.upgradeEyecatcher=t(this.upgradeEyecatcher,this),this.setupEyecatcher=t(this.setupEyecatcher,this),this.update=t(this.update,this),this.widgetReady=t(this.widgetReady,this),this.setHeight=t(this.setHeight,this),this.setBadge=t(this.setBadge,this),this.toggle=t(this.toggle,this),this.reload=t(this.reload,this),this.hide=t(this.hide,this),this.updatePosition=t(this.updatePosition,this),this.setPosition=t(this.setPosition,this),this.getPosition=t(this.getPosition,this),this.show=t(this.show,this),this.getStorage=t(this.getStorage,this),this.setStorage=t(this.setStorage,this),this.getStorageKey=t(this.getStorageKey,this),this.storageItem=t(this.storageItem,this),this.attachListeners=t(this.attachListeners,this),this.createElements=t(this.createElements,this),this.setup=t(this.setup,this),this.destroy=t(this.destroy,this),this.realInit=t(this.realInit,this),this.init=t(this.init,this),this.log=t(this.log,this);var e;e="undefined"!=typeof HW_config&&null!==HW_config?HW_config:{},"undefined"!=typeof HW_config&&null!==HW_config&&this.init(e)}return e.prototype.pushMessage=function(e,t){return null==t&&(t={}),this.elements.frame.contentWindow.postMessage([e,t],"*")},e.prototype.log=function(){if(this.localOptions.debug)return console.log("[Headway Debug]",arguments)},e.prototype.init=function(e){var t;try{this.realInit(e)}catch(e){t=e,console.warn("[Headway Error]",t)}return this},e.prototype.realInit=function(e){if(this.localOptions=e||HW_config,this.accountId=this.localOptions.account,this.localOptions.enabled=null==this.localOptions.enabled||this.localOptions.enabled,this.destroy(),this.localOptions.enabled)return null!=this.localOptions.account&&null!=this.localOptions.selector?(this.visible=!1,this.currentAlign="left",this.eyecatcherLevel=0,null!=this.localOptions.callbacks&&(this.localCallbacks=this.localOptions.callbacks),this.localOptions.callbacks=null,window.setTimeout(function(e){return function(){return e.setup()}}(this),1e3)):console.warn("[Headway] Cannot load widget, `account` or `selector` config incorrect")},e.prototype.destroy=function(){var e,t,n,i,s,o;return e=document.querySelector("#HW_badge_cont"),t=document.querySelector("#HW_frame_cont"),n=document.querySelector("#HW_styles_cont"),null!=e&&null!=(i=e.parentNode)&&i.removeChild(e),null!=t&&null!=(s=t.parentNode)&&s.removeChild(t),null!=n&&null!=(o=n.parentNode)?o.removeChild(n):void 0},e.prototype.setup=function(){return this.badgeEl=document.querySelector(this.localOptions.selector),this.elements={frameCont:document.createElement("div"),frame:document.createElement("iframe"),badgeCont:document.createElement("span"),badge:document.createElement("span"),style:document.createElement("style"),animate:document.createElement("link")},this.styles="#HW_badge_cont {\n  visibility: hidden;\n  pointer-events: none;\n  display: block;\n  height: 32px;\n  width: 32px;\n  cursor: pointer;\n  position: relative;\n}\n\n#HW_badge_cont.HW_visible {\n  visibility: visible;\n  pointer-events: auto;\n}\n\n#HW_badge {\n  display: block;\n  border-radius: 20px;\n  background: #CD4B5B;\n  height: 16px;\n  width: 16px;\n  color: #fff;\n  text-align: center;\n  line-height: 16px;\n  font-size: 11px;\n  cursor: pointer;\n  position: absolute;\n  top: 8px;\n  left: 8px;\n  opacity: 0;\n  transform: scale(0);\n  transition: all 0.3s;\n}\n\n#HW_badge.HW_softHidden {\n  background: #d4d4d4;\n  opacity: 1;\n  transform: scale(0.6);\n}\n\n#HW_badge.HW_hidden {\n  opacity: 0;\n  transform: scale(0);\n}\n\n#HW_badge.HW_visible {\n  opacity: 1;\n  transform: scale(1.0);\n}\n\n#HW_frame_cont {\n  pointer-events: none;\n  border-radius: 4px;\n  box-shadow: 0 0 1px rgba(99, 114, 130, 0.32), 0 8px 16px rgba(27, 39, 51, 0.08);\n  background: #fff;\n  border: none;\n  position: absolute;\n  top: -900em;\n  z-index: 999;\n  width: 340px;\n  height: 300px;\n  opacity: 0;\n  will-change: height, margin-top, opacity;\n  margin-top: -10px;\n  transition: margin-top 0.15s ease-out, opacity 0.1s ease-out, height 0.3s ease-out;\n}\n\n#HW_frame_cont.HW_visible {\n  opacity: 1;\n  pointer-events: auto;\n  margin-top: 0px;\n}\n\n#HW_frame {\n  background: #fff;\n  border: none;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  border-radius: 4px;\n  position: relative;\n  z-index: 900;\n  transition: height 0.3s ease-out;\n}",null!=this.badgeEl?(this.createElements(),this.attachListeners()):console.warn("[Headway] Element provided by selector does not exist.")},e.prototype.createElements=function(){var e,t,n;return this.badgeEl.appendChild(this.elements.badgeCont),this.elements.badgeCont.id="HW_badge_cont",this.elements.badgeCont.addEventListener("click",this.toggle,!1),this.elements.badgeCont.appendChild(this.elements.badge),this.elements.badge.id="HW_badge",document.body.appendChild(this.elements.frameCont),this.elements.frameCont.id="HW_frame_cont",n=this.localOptions.protocol?this.localOptions.protocol+":":location.protocol,t=this.localOptions.debugHost||"headway-widget.net",e=n+"//"+t+"/widgets/"+this.localOptions.account,this.elements.frameCont.appendChild(this.elements.frame),this.elements.frame.id="HW_frame",this.elements.frame.src=e,this.elements.frame.sandbox="allow-same-origin allow-scripts allow-top-navigation allow-popups",document.body.appendChild(this.elements.style),this.elements.style.id="HW_styles_cont",this.elements.style.textContent=this.styles},e.prototype.attachListeners=function(){var e;return this.ticking=!1,e=function(e){return function(t){var n,i;switch(i=t.data[0],n=t.data[1],i){case"setHeight":return e.setHeight(n);case"setBadge":return e.setBadge(n);case"widgetReady":return e.widgetReady(n);case"hide":return e.hide();case"reload":return e.reload();case"update":return e.update(n);case"setStorage":return e.setStorage(n)}}}(this),window.addEventListener("message",e),window.addEventListener("scroll",this.updatePosition),window.addEventListener("resize",this.updatePosition),document.body.addEventListener("click",function(e){return function(t){if(e.visible)return e.hide()}}(this)),this.elements.frame.addEventListener("load",function(e){return function(t){var n;return n={host:location.hostname,options:e.localOptions,storage:{seen:e.getStorage("seen"),read:e.getStorage("read")}},e.pushMessage("ready",n),e.log("Widget.attachListeners#load",n)}}(this))},e.prototype.storageItem=function(e,t,n){var i,s,o;try{n="set"===e?null!=(s=window.localStorage)?s.setItem(t,n):void 0:null!=(o=window.localStorage)?o.getItem(t):void 0}catch(e){i=e,console.warn("[Headway Error]",i)}return n},e.prototype.getStorageKey=function(e){return e+"["+this.accountId+"]"},e.prototype.setStorage=function(e){var t;return t=this.getStorageKey(e.key),this.storageItem("set",t,e.ids),this.log("Widget.setStorage",t,e)},e.prototype.getStorage=function(e){var t,n;return n=this.getStorageKey("HW_"+e+"Items"),t=this.storageItem("get",n),t=t?null!=t?t.split(","):void 0:[],this.log("Widget.getStorage("+e+")",n,t),t},e.prototype.show=function(){return this.visible=!0,this.updatePosition(),this.elements.frameCont.classList.add("HW_visible"),this.pushMessage("opened",{})},e.prototype.getPosition=function(e){var t,n,i,s,o,a,r;return i={badge:this.elements.badgeCont.getBoundingClientRect(),frame:this.elements.frameCont.getBoundingClientRect()},s=parseInt(i.frame.width),t=parseInt(i.badge.height),r={top:window.pageYOffset+t,right:s-i.badge.width},a={h:i.badge.left>=document.body.scrollWidth-s,v:i.badge.top+i.frame.height>document.documentElement.clientHeight},n=i.badge.left-s<0,o={h:a.h?"left":"right",v:a.v?"top":"bottom"},n&&(o.h="fill"),[i.badge,i.frame,r,o]},e.prototype.setPosition=function(){var e,t,n,i,s;return s=this.getPosition(),e=s[0],t=s[1],i=s[2],n=s[3],"right"===n.h?this.elements.frameCont.style.left=e.left+"px":"left"===n.h?this.elements.frameCont.style.left=e.left-i.right+"px":this.elements.frameCont.style.left="0px","top"===n.v?this.elements.frameCont.style.top=e.top+i.top-t.height-e.height+"px":this.elements.frameCont.style.top=e.top+i.top+"px"},e.prototype.updatePosition=function(){if(this.visible)return this.ticking||window.requestAnimationFrame(function(e){return function(){return e.setPosition(),e.ticking=!1}}(this)),this.ticking=!0},e.prototype.hide=function(){return this.visible=!1,this.elements.frameCont.classList.remove("HW_visible"),this.pushMessage("closed",{})},e.prototype.reload=function(){return this.elements.frame.contentWindow.location.reload()},e.prototype.toggle=function(e){return e.preventDefault(),e.stopPropagation(),this.visible?this.hide():(this.show(),null!=this.localCallbacks&&null!=this.localCallbacks.onShowWidget?this.localCallbacks.onShowWidget.call(this):void 0)},e.prototype.setBadge=function(e){return e.counter>=1?(this.elements.badge.classList.add("HW_visible"),this.elements.badge.innerHTML=e.counter,this.elements.badge.dataset.countUnseen=e.counter,this.localOptions.eyecatcher?this.setupEyecatcher():void 0):(this.removeEyecatcher(),this.localOptions.softHide?(this.elements.badge.classList.remove("HW_visible"),this.elements.badge.classList.add("HW_softHidden"),this.elements.badge.innerHTML="",this.elements.badge.dataset.countUnseen=""):(window.setTimeout(function(e){return function(){return e.elements.badgeCont.classList.remove("HW_visible")}}(this),300),this.elements.badge.classList.remove("HW_visible"),this.elements.badge.classList.add("HW_hidden"),this.elements.badge.innerHTML=e.counter,this.elements.badge.dataset.countUnseen=""))},e.prototype.setHeight=function(e){return this.elements.frame.style.height=e.height+"px",this.elements.frameCont.style.height=e.height+"px"},e.prototype.widgetReady=function(e){return this.elements.badgeCont.classList.add("HW_visible"),this.localOptions=e.options,window.setTimeout(function(t){return function(){return t.setBadge(e)}}(this),1e3*this.localOptions.badgeDelay),this.log("Widget.widgetReady",e)},e.prototype.update=function(e){return this.setBadge(e),this.reload()},e.prototype.setupEyecatcher=function(){var e;return document.body.appendChild(this.elements.animate),this.elements.animate.rel="stylesheet",this.elements.animate.href=location.protocol+"//cdn.headwayapp.co/headway-animate.css",e=["blank","pulse","jello","rubberBand","wobble","shake","bounce"],this.elements.badge.classList.add("HW_animated"),this.upgradeEyecatcher(e)},e.prototype.upgradeEyecatcher=function(e){var t;return t=0,window.setInterval(function(n){return function(){var i;return i="HW_"+e[n.eyecatcherLevel],e.length===n.eyecatcherLevel&&(i=e[e.length-1]),n.elements.badge.classList.add(i),window.setTimeout(function(){if(n.elements.badge.classList.remove(i),t+=1,t>=5)return t=0,n.eyecatcherLevel=n.eyecatcherLevel+1,n.elements.badge.classList.remove(i)},1e3)}}(this),5500)},e.prototype.removeEyecatcher=function(){return this.elements.badge.className=""},e}(),window.Headway=new e}).call(this);
//# sourceMappingURL=widget.js.map
